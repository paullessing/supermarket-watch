<div class="content">
  <h2 class="title">Compare Prices</h2>

  <div *ngFor="let comparison of priceComparisons; trackBy trackById; let index = index;">
    <div
      style="width: 150px; height: 150px; background-repeat: no-repeat; background-size: cover; background-position: center;"
      [style.background-image]="getBackgroundImage(comparison)"
    ></div>
    <p>{{ comparison.name }}</p>
    <p>
      {{ comparison.pricePerUnit.best | currency:'GBP' }}/{{ comparison.unitOfMeasurement.amount === 1 ? '' : comparison.unitOfMeasurement.amount }}{{ comparison.unitOfMeasurement.name }}
      <span *ngIf="comparison.pricePerUnit.best !== comparison.pricePerUnit.usual"> (usually {{ comparison.pricePerUnit.usual | currency:'GBP' }}/{{ comparison.unitOfMeasurement.amount === 1 ? '' : comparison.unitOfMeasurement.amount }}{{ comparison.unitOfMeasurement.name }})</span>
    </p>
  </div>

  <table *ngIf="priceComparisons.length">
    <ng-container *ngFor="let comparison of priceComparisons; trackBy trackById; let index = index">
      <thead>
      <tr>
        <td colspan="2" style="padding: 0.25rem 0.5rem 0.25rem 0; font-weight: bold">{{ comparison.name }}</td>
        <td><button class="tracked-product__edit" (click)="editIndex = index">Edit</button></td>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let product of comparison.products; trackBy trackById">
        <tr>
          <td style="padding: 0.25rem 0.5rem">
            <em [title]="product.name">{{ product.supermarket }}</em>
          </td>
          <td
            style="padding: 0.25rem 0.5rem"
            [style.color]="product.specialOffer? 'red' : null"
          >
            {{ product.price | currency:'GBP' }}
          </td>
          <td style="padding: 0.25rem 0.5rem">
            {{ product.pricePerUnit | currency:'GBP' }}/{{ comparison.unitOfMeasurement.amount === 1 ? '' : comparison.unitOfMeasurement.amount }}{{ comparison.unitOfMeasurement.name }}
          </td>
        </tr>
        <tr *ngIf="product.specialOffer">
          <td colspan="1"></td>
          <td colspan="2" style="padding: 0 0.5rem 0.25rem; color: red">
            {{ product.specialOffer.offerText }}
          </td>
        </tr>
      </ng-container>
      </tbody>
    </ng-container>
  </table>
</div>

<app-edit-price-comparison-dialog
  *ngIf="editIndex !== null"
  [comparison]="priceComparisons[editIndex]"
  (editDetails)="onEditComparison($event)"
  (exit)="editIndex = null"
  (deletePriceComparison)="deletePriceComparison($event.id); editIndex = null"
  (removeProduct)="removeProduct($event)"
></app-edit-price-comparison-dialog>
